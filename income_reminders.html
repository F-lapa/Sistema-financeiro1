<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lembrete de Receitas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #2c3e50;
            margin: 0;
            padding: 0;
            color: #ecf0f1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        .container {
            width: 90%;
            max-width: 600px;
            background-color: #34495e;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #bdc3c7;
        }
        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #3498db;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 14px;
            background-color: #2c3e50;
            color: #ecf0f1;
            transition: all 0.3s ease;
        }
        .form-group input:focus {
            border: 2px solid #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }
        button {
            width: 100%;
            padding: 10px;
            background-color: #3498db;
            color: #ecf0f1;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        button:hover {
            background-color: darken(#3498db, 10%);
            transform: scale(1.05);
        }
        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: separate;
            border-spacing: 0 8px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            background-color: #34495e;
        }
        th {
            background-color: #2c3e50;
            color: #bdc3c7;
        }
        .status {
            font-weight: bold;
        }
        .status.open {
            color: red;
        }
        .status.received {
            color: green;
        }
        .fa-trash-alt, .fa-check, .fa-edit {
            cursor: pointer;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }
        .modal-content {
            background-color: #34495e;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #444;
            width: 80%;
            max-width: 400px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            color: #ecf0f1;
            text-align: center;
            animation: fadein 0.5s;
        }
        .close {
            color: #ecf0f1;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: #3498db;
            text-decoration: none;
            cursor: pointer;
        }
        @keyframes fadein {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeout {
            from { opacity: 1; }
            to { opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Lembrete de Receitas</h1>
        <div class="form-group">
            <label for="day">Dia do Mês:</label>
            <input type="number" id="day" min="1" max="31">
        </div>
        <div class="form-group">
            <label for="description">Descrição:</label>
            <input type="text" id="description">
        </div>
        <div class="form-group">
            <label for="amount">Valor (R$):</label>
            <input type="text" id="amount" placeholder="0,00">
        </div>
        <button onclick="addIncomeReminder()">Adicionar Lembrete</button>
        
        <table id="incomeRemindersTable">
            <thead>
                <tr>
                    <th>Dia</th>
                    <th>Descrição</th>
                    <th>Valor</th>
                    <th>Status</th>
                    <th>Ação</th>
                </tr>
            </thead>
            <tbody>
                <!-- Income reminders will be added here -->
            </tbody>
        </table>
    </div>

    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeConfirmModal()">&times;</span>
            <p id="confirmMessage"></p>
            <button onclick="confirmIncome()">Confirmar</button>
            <button onclick="closeConfirmModal()">Cancelar</button>
        </div>
    </div>

    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2>Editar Receita</h2>
            <div class="form-group">
                <label for="editDay">Dia do Mês:</label>
                <input type="number" id="editDay" min="1" max="31">
            </div>
            <div class="form-group">
                <label for="editDescription">Descrição:</label>
                <input type="text" id="editDescription">
            </div>
            <div class="form-group">
                <label for="editAmount">Valor (R$):</label>
                <input type="text" id="editAmount" placeholder="0,00">
            </div>
            <button onclick="saveEditIncomeReminder()">Salvar</button>
        </div>
    </div>

    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDeleteModal()">&times;</span>
            <p id="deleteMessage"></p>
            <button onclick="deleteIncome()">Excluir</button>
            <button onclick="closeDeleteModal()">Cancelar</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyDgTFBPipaSGqJlahiT-THgzBH4JKuQSA4",
            authDomain: "sistema-de-receitas-e-despesas.firebaseapp.com",
            databaseURL: "https://sistema-de-receitas-e-despesas-default-rtdb.firebaseio.com",
            projectId: "sistema-de-receitas-e-despesas",
            storageBucket: "sistema-de-receitas-e-despesas.appspot.com",
            messagingSenderId: "252102478972",
            appId: "1:252102478972:web:c7e9e4c25b3bc7c6c50df9",
            measurementId: "G-K2HCS7WNZV"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        let incomeReminders = [];
        let currentReminderId;
        let editReminderId;

        auth.onAuthStateChanged(user => {
            if (user) {
                const userId = user.uid;
                loadIncomeReminders(userId);
                setMonthlyStatus(userId);
            } else {
                window.location.href = 'index.html';  
            }
        });

        function saveIncomeReminders() {
            const userId = auth.currentUser.uid;
            database.ref('incomeReminders/' + userId).set(incomeReminders);
        }

        function loadIncomeReminders(userId) {
            database.ref('incomeReminders/' + userId).once('value').then((snapshot) => {
                if (snapshot.val()) {
                    incomeReminders = snapshot.val();
                    renderIncomeReminders();
                }
            });
        }

        function addIncomeReminder() {
            const day = document.getElementById('day').value;
            const description = document.getElementById('description').value;
            const amount = parseCurrency(document.getElementById('amount').value);

            const reminder = { id: generateReminderId(), day, description, amount, status: 'Em Aberto' };
            incomeReminders.push(reminder);
            saveIncomeReminders();
            renderIncomeReminders();

            document.getElementById('day').value = '';
            document.getElementById('description').value = '';
            document.getElementById('amount').value = '0,00';
        }

        function renderIncomeReminders() {
            const tbody = document.getElementById('incomeRemindersTable').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';

            incomeReminders.forEach(reminder => {
                const row = tbody.insertRow();
                
                const cellDay = row.insertCell(0);
                const cellDescription = row.insertCell(1);
                const cellAmount = row.insertCell(2);
                const cellStatus = row.insertCell(3);
                const cellAction = row.insertCell(4);

                cellDay.innerText = reminder.day;
                cellDescription.innerText = reminder.description;
                cellAmount.innerText = formatCurrency(reminder.amount);
                cellStatus.innerHTML = `<span class="status ${reminder.status === 'Em Aberto' ? 'open' : 'received'}">${reminder.status}</span>`;
                cellAction.innerHTML = `
                    <i class="fas fa-check" onclick="confirmIncomeReminder('${reminder.id}')" style="color:green; ${reminder.status === 'Já Recebi' ? 'display:none;' : ''}"></i>
                    <i class="fas fa-edit" onclick="openEditIncomeReminderModal('${reminder.id}')" style="color:yellow;"></i>
                    <i class="fas fa-trash-alt" onclick="confirmDeleteIncomeReminder('${reminder.id}')" style="color:red;"></i>
                `;
            });
        }

        function confirmIncomeReminder(id) {
            currentReminderId = id;
            document.getElementById('confirmMessage').innerText = 'Tem certeza que deseja confirmar o recebimento desta receita?';
            openConfirmModal();
        }

        function confirmIncome() {
            const reminderIndex = incomeReminders.findIndex(r => r.id === currentReminderId);
            if (reminderIndex > -1) {
                const reminder = incomeReminders[reminderIndex];
                reminder.status = 'Já Recebi';
                reminder.lastConfirmed = new Date().toISOString().split('T')[0];
                addTransactionFromReminder(reminder);
                saveIncomeReminders();
                renderIncomeReminders();
                closeConfirmModal();
            }
        }

        function addTransactionFromReminder(reminder) {
            const transaction = {
                id: generateTransactionId(),
                date: getCurrentDate(),
                description: reminder.description,
                amount: reminder.amount,
                type: 'receita'
            };
            const userId = auth.currentUser.uid;
            database.ref('transactions/' + userId).push(transaction);
        }

        function openEditIncomeReminderModal(id) {
            const reminder = incomeReminders.find(r => r.id === id);
            if (reminder) {
                editReminderId = id;
                document.getElementById('editDay').value = reminder.day;
                document.getElementById('editDescription').value = reminder.description;
                document.getElementById('editAmount').value = reminder.amount.toFixed(2).replace('.', ',');
                openEditModal();
            }
        }

        function saveEditIncomeReminder() {
            const reminderIndex = incomeReminders.findIndex(r => r.id === editReminderId);
            if (reminderIndex > -1) {
                incomeReminders[reminderIndex].day = document.getElementById('editDay').value;
                incomeReminders[reminderIndex].description = document.getElementById('editDescription').value;
                incomeReminders[reminderIndex].amount = parseCurrency(document.getElementById('editAmount').value);
                saveIncomeReminders();
                renderIncomeReminders();
                closeEditModal();
            }
        }

        function confirmDeleteIncomeReminder(id) {
            currentReminderId = id;
            document.getElementById('deleteMessage').innerText = 'Tem certeza que deseja excluir este lembrete de receita?';
            openDeleteModal();
        }

        function deleteIncome() {
            incomeReminders = incomeReminders.filter(reminder => reminder.id !== currentReminderId);
            saveIncomeReminders();
            renderIncomeReminders();
            closeDeleteModal();
        }

        function generateReminderId() {
            return '_' + Math.random().toString(36).substr(2, 9);
        }

        function formatCurrency(value) {
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        function parseCurrency(value) {
            return parseFloat(value.replace(/\./g, '').replace(',', '.').replace('R$', '')) || 0;
        }

        function getCurrentDate() {
            const now = new Date();
            const offset = -3;
            const brasiliaTime = new Date(now.getTime() + offset * 3600 * 1000);
            return brasiliaTime.toISOString().split('T')[0];
        }

        function setMonthlyStatus(userId) {
            const currentMonth = new Date().getMonth();
            incomeReminders.forEach(reminder => {
                const reminderMonth = new Date(reminder.lastConfirmed || '').getMonth();
                if (currentMonth !== reminderMonth) {
                    reminder.status = 'Em Aberto';
                }
            });
            saveIncomeReminders();
            renderIncomeReminders();
        }

        function openConfirmModal() {
            const modal = document.getElementById('confirmModal');
            modal.style.display = 'block';
            modal.style.animation = 'fadein 0.5s';
        }

        function closeConfirmModal() {
            const modal = document.getElementById('confirmModal');
            modal.style.animation = 'fadeout 0.5s';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 500);
        }

        function openEditModal() {
            const modal = document.getElementById('editModal');
            modal.style.display = 'block';
            modal.style.animation = 'fadein 0.5s';
        }

        function closeEditModal() {
            const modal = document.getElementById('editModal');
            modal.style.animation = 'fadeout 0.5s';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 500);
        }

        function openDeleteModal() {
            const modal = document.getElementById('deleteModal');
            modal.style.display = 'block';
            modal.style.animation = 'fadein 0.5s';
        }

        function closeDeleteModal() {
            const modal = document.getElementById('deleteModal');
            modal.style.animation = 'fadeout 0.5s';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 500);
        }
    </script>
</body>
</html>
